import{j as a}from"./jsx-runtime-DiklIkkE.js";import{r as c}from"./index-DRjF_FHU.js";import{a as G}from"./gridUtils-C-o1KBgq.js";import{S as I}from"./StoryUtils-B3A1VrTU.js";import{b as B,c as F}from"./DFViewerDataHelper-l27HaZum.js";import"./lodash-CGIzQN7T.js";import"./HistogramCell-WXbqT_Ov.js";import"./index-Bx0Ph3cE.js";import"./ChartCell-CdGzSEf4.js";import"./tiny-invariant-CopsF_GD.js";import"./main.esm-CraDeAap.js";import"./client-DQginrwT.js";const $={col_name:"index",header_name:"index",displayer_args:{displayer:"obj"}},h=s=>({col_name:s,header_name:s,displayer_args:{displayer:"obj"}}),L={column_config:[h("a"),h("b")],left_col_configs:[$],pinned_rows:[{primary_key_val:"null_count",displayer_args:{displayer:"obj"}},{primary_key_val:"empty_count",displayer_args:{displayer:"obj"}}]},w=[{ts:1e3,event:"dfi_cols_fields",fields:["index","int_col","str_col","float_col"]},{ts:1200,event:"all_stats_update",len:2,sample:{index:"null_count",int_col:0,str_col:0,float_col:0},all_stats:[{index:"null_count",int_col:0,str_col:0,float_col:0},{index:"empty_count",int_col:0,str_col:0,float_col:0}]},{ts:1400,event:"pinned_rows_config",pinned_keys:["null_count","empty_count"],cfg:{pinned_rows:[{primary_key_val:"null_count",displayer_args:{displayer:"obj"}},{primary_key_val:"empty_count",displayer_args:{displayer:"obj"}}]}},{ts:2e3,event:"custom_msg",msg:{type:"infinite_resp",key:{start:0,end:100}},buffers_len:1},{ts:2200,event:"infinite_resp_parsed",key:{start:0,end:100},rows_len:100,total_len:5e3,rows:Array.from({length:100},(s,e)=>({index:e,int_col:e+10,str_col:`row_${e}`,float_col:e*1.5}))},{ts:3e3,event:"custom_msg",msg:{type:"infinite_resp",key:{start:100,end:200}},buffers_len:1},{ts:3200,event:"infinite_resp_parsed",key:{start:100,end:200},rows_len:100,total_len:5e3,rows:Array.from({length:100},(s,e)=>({index:e+100,int_col:e+110,str_col:`row_${e+100}`,float_col:(e+100)*1.5}))},{ts:4e3,event:"custom_msg",msg:{type:"infinite_resp",key:{start:200,end:300}},buffers_len:1},{ts:4200,event:"infinite_resp_parsed",key:{start:200,end:300},rows_len:100,total_len:5e3,rows:Array.from({length:100},(s,e)=>({index:e+200,int_col:e+210,str_col:`row_${e+200}`,float_col:(e+200)*1.5}))}],N=()=>{const[s,e]=c.useState([]),[D,b]=c.useState(L),[p,k]=c.useState([]),u=c.useRef([]),[x,E]=c.useState(!1),O=c.useMemo(()=>p&&p.length>0?B(p):F([],0),[p]);c.useEffect(()=>{const l=()=>{if(window._buckarooTranscriptOneSecondGap===!0&&w.length>0)console.log(`[Replay] Loading hardcoded transcript with ${w.length} events`),u.current=w.slice();else{const n=window._buckarooTranscript||[];console.log(`[Replay] Loading window transcript with ${n.length} events`),u.current=Array.isArray(n)?n.slice():[]}};l();const _=setTimeout(l,10);return()=>clearTimeout(_)},[]);const P=()=>{if(x)return;E(!0);const l=u.current.slice().sort((t,n)=>t.ts-n.ts);let _=0;l.forEach((t,n)=>{if(n===0)_=0;else{const y=l[n-1],o=t.ts-y.ts;_+=Math.max(o,10)}const S=_;setTimeout(()=>{const y=Date.now();if(console.log(`[Replay] Event ${n+1}/${l.length} fired at ${y}, delay was ${S}ms, event: ${t.event}`),t.event==="pinned_rows_config"){const o=t.pinned_keys||[];b(d=>({...d,pinned_rows:o.map(r=>({primary_key_val:r,displayer_args:{displayer:"obj"}}))}))}else if(t.event==="dfi_cols_fields"){const d=(t.fields||[]).filter(r=>r&&r!=="index");b(r=>({...r,column_config:d.map(i=>h(i)),left_col_configs:[$]}))}else if(t.event==="all_stats_update"){const o=function d(r){if(typeof r=="bigint")return r.toString();if(Array.isArray(r))return r.map(i=>d(i));if(r&&typeof r=="object"){const i={};for(const g in r)try{i[g]=d(r[g])}catch{i[g]=null}return i}return r}(t.all_stats||[]);e(o)}else if(t.event==="infinite_resp_parsed"&&t.rows&&Array.isArray(t.rows)){const o=t.rows;k(Array.isArray(o)?o:[])}else t.event==="ds_success"&&p.length===0&&k([])},S)})};return a.jsx(I,{children:a.jsxs("div",{style:{width:760},children:[a.jsx("p",{style:{marginBottom:8},children:"Replays a captured transcript (window._buckarooTranscript) of model updates and custom messages, applying pinned row config, summary updates (all_stats), and simulating infinite responses by switching to 5 visible rows. Click Start after running the Jupyter widget with transcript logging enabled to reproduce the behavior here."}),a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("button",{onClick:P,disabled:x,children:"Start Replay"}),a.jsxs("span",{style:{marginLeft:12},children:["events: ",u.current.length]})]}),a.jsx("div",{style:{height:420},children:a.jsx(G,{data_wrapper:O,df_viewer_config:D,summary_stats_data:s,activeCol:["a","a"],setActiveCol:()=>{},outside_df_params:{}})})]})})},Z={title:"Buckaroo/DFViewer/PinnedRowsTranscriptReplayer",component:N,parameters:{layout:"centered"},tags:["autodocs"]},f={args:{}},m={args:{},decorators:[s=>(typeof window<"u"&&(window._buckarooTranscriptOneSecondGap=!0),a.jsx(s,{}))]};var j,v,R;f.parameters={...f.parameters,docs:{...(j=f.parameters)==null?void 0:j.docs,source:{originalSource:`{
  args: {}
}`,...(R=(v=f.parameters)==null?void 0:v.docs)==null?void 0:R.source}}};var A,T,C;m.parameters={...m.parameters,docs:{...(A=m.parameters)==null?void 0:A.docs,source:{originalSource:`{
  args: {},
  decorators: [Story => {
    // Set flag synchronously before component renders
    // @ts-ignore
    if (typeof window !== 'undefined') {
      // @ts-ignore
      window._buckarooTranscriptOneSecondGap = true;
    }
    return <Story />;
  }]
}`,...(C=(T=m.parameters)==null?void 0:T.docs)==null?void 0:C.source}}};const ee=["Primary","OneSecondGap"];export{m as OneSecondGap,f as Primary,ee as __namedExportsOrder,Z as default};
