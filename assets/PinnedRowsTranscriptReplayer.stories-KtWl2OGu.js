import{j as r}from"./jsx-runtime-DiklIkkE.js";import{r as n}from"./index-DRjF_FHU.js";import{a as T}from"./gridUtils-C-o1KBgq.js";import{S as P}from"./StoryUtils-B3A1VrTU.js";import{b as I,c as B}from"./DFViewerDataHelper-l27HaZum.js";import"./lodash-CGIzQN7T.js";import"./HistogramCell-WXbqT_Ov.js";import"./index-Bx0Ph3cE.js";import"./ChartCell-CdGzSEf4.js";import"./tiny-invariant-CopsF_GD.js";import"./main.esm-CraDeAap.js";import"./client-DQginrwT.js";const x={col_name:"index",header_name:"index",displayer_args:{displayer:"obj"}},_=l=>({col_name:l,header_name:l,displayer_args:{displayer:"obj"}}),F={column_config:[_("a"),_("b")],left_col_configs:[x],pinned_rows:[{primary_key_val:"null_count",displayer_args:{displayer:"obj"}},{primary_key_val:"empty_count",displayer_args:{displayer:"obj"}}]},M=()=>{const[l,R]=n.useState([]),[S,y]=n.useState(F),[p,g]=n.useState([]),m=n.useRef([]),[w,k]=n.useState(!1),A=n.useMemo(()=>p&&p.length>0?I(p):B([],0),[p]);n.useEffect(()=>{const o=window._buckarooTranscript||[];m.current=Array.isArray(o)?o.slice():[]},[]);const C=()=>{if(w)return;k(!0);const o=m.current.slice().sort((t,i)=>t.ts-i.ts),D=o.length?o[0].ts:Date.now(),E=120;let f=0;o.forEach(t=>{let i=t.ts-D;i<=f&&(i=f+E),f=i,setTimeout(()=>{if(t.event==="pinned_rows_config"){const s=t.pinned_keys||[];y(c=>({...c,pinned_rows:s.map(e=>({primary_key_val:e,displayer_args:{displayer:"obj"}}))}))}else if(t.event==="dfi_cols_fields"){const c=(t.fields||[]).filter(e=>e&&e!=="index");y(e=>({...e,column_config:c.map(a=>_(a)),left_col_configs:[x]}))}else if(t.event==="all_stats_update"){const s=function c(e){if(typeof e=="bigint")return e.toString();if(Array.isArray(e))return e.map(a=>c(a));if(e&&typeof e=="object"){const a={};for(const u in e)try{a[u]=c(e[u])}catch{a[u]=null}return a}return e}(t.all_stats||[]);R(s)}else if(t.event==="infinite_resp_parsed"&&t.rows&&Array.isArray(t.rows)){const s=t.rows;g(Array.isArray(s)?s:[])}else t.event==="ds_success"&&p.length===0&&g([])},i)})};return r.jsx(P,{children:r.jsxs("div",{style:{width:760},children:[r.jsx("p",{style:{marginBottom:8},children:"Replays a captured transcript (window._buckarooTranscript) of model updates and custom messages, applying pinned row config, summary updates (all_stats), and simulating infinite responses by switching to 5 visible rows. Click Start after running the Jupyter widget with transcript logging enabled to reproduce the behavior here."}),r.jsxs("div",{style:{marginBottom:8},children:[r.jsx("button",{onClick:C,disabled:w,children:"Start Replay"}),r.jsxs("span",{style:{marginLeft:12},children:["events: ",m.current.length]})]}),r.jsx("div",{style:{height:420},children:r.jsx(T,{data_wrapper:A,df_viewer_config:S,summary_stats_data:l,activeCol:["a","a"],setActiveCol:()=>{},outside_df_params:{}})})]})})},Q={title:"Buckaroo/DFViewer/PinnedRowsTranscriptReplayer",component:M,parameters:{layout:"centered"},tags:["autodocs"]},d={args:{}};var h,b,j;d.parameters={...d.parameters,docs:{...(h=d.parameters)==null?void 0:h.docs,source:{originalSource:`{
  args: {}
}`,...(j=(b=d.parameters)==null?void 0:b.docs)==null?void 0:j.source}}};const U=["Primary"];export{d as Primary,U as __namedExportsOrder,Q as default};
